<!DOCTYPE html>
<html>

<head>
    <script src="leap-0.6.4.js"></script>

    <script>
    
    
         var ws = new WebSocket("ws://localhost:8000/")

         ws.onmessage = function (event) {
            // to test whether connection is working
            console.log(event.data);
            }
        
    
        var controller = new Leap.Controller({ enableGestures: true });
        var angles = {};
        var angle = (function(v1,v2){
          var top = v1[0]*v2[0] + v1[1]*v2[1] + v1[2]*v2[2];
          var bottom = Math.sqrt(v1[0]*v1[0]+v1[1]*v1[1]+v1[2]*v1[2])*Math.sqrt(v2[0]*v2[0]+v2[1]*v2[1]+v2[2]*v2[2]);
          return top/bottom;
        })
        controller.loop(function (frame) {
            var hand = frame.hands;
            if (hand.length > 0) {
              var json = {
        "0":{
          "MPA":angle(hand[0].fingers[1].metacarpal.direction(),hand[0].fingers[1].proximal.direction()),
          "PIA":angle(hand[0].fingers[1].proximal.direction(),hand[0].fingers[1].intermediate.direction()),
          "IPA":angle(hand[0].fingers[1].proximal.direction(),hand[0].palmNormal)
        },
        "1":{
          "MPA":angle(hand[1].fingers[2].metacarpal.direction(),hand[0].fingers[2].proximal.direction()),
          "PIA":angle(hand[0].fingers[2].proximal.direction(),hand[0].fingers[2].intermediate.direction()),
          "IPA":angle(hand[0].fingers[2].proximal.direction(),hand[0].palmNormal)
        },
        "2":{
          "MPA":angle(hand[0].fingers[3].metacarpal.direction(),hand[0].fingers[3].proximal.direction()),
          "PIA":angle(hand[0].fingers[3].proximal.direction(),hand[0].fingers[3].intermediate.direction()),
          "IPA":angle(hand[0].fingers[3].proximal.direction(),hand[0].palmNormal)
        },
        "3":{
          "MPA":angle(hand[0].fingers[4].metacarpal.direction(),hand[0].fingers[4].proximal.direction()),
          "PIA":angle(hand[0].fingers[4].proximal.direction(),hand[0].fingers[4].intermediate.direction()),
          "IPA":angle(hand[0].fingers[4].proximal.direction(),hand[0].palmNormal)
        },
        "armdata":{
          "pitch":hand[0].pitch(),
          "roll":hand[0].roll(),
          "yaw":hand[0].yaw(),
          "arm direction" : hand[0].arm.direction()
        },
        "exerciseid" : 2
      }

                }


                document.getElementById("out").innerHTML = json;
                ws.send(JSON.stringify(json))
            });  </script>
</head>

<body>
    <pre>
        <div id="out"></div>
      </pre>
</body>

</html>